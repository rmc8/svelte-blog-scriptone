<script lang="ts">
	import { onMount } from 'svelte';
	import axios from 'axios';
	import moment from 'moment';
	import Header from '../../../components/HeaderForPrsk.svelte';
	import Footer from '../../../components/Footer.svelte';
	import Chart from './Chart.svelte';

	let columns = {};
	let data = [];
	let loading = true;

	onMount(async () => {
		try {
			const response = await axios.get(
				'https://script.google.com/macros/s/AKfycbxJ9EzwcUE8kIxcNovzZRIGkN9wBSNy3hpptRzuGJHKMFCf9LzMZ8783hfMddr3Wn1Q/exec'
			);
			const dataResponse = response.data;
			columns = dataResponse.columns;
			data = dataResponse.data;
		} catch (error) {
			console.error(error);
		} finally {
			loading = false;
		}
	});

	function formatDate(dateStr) {
		return moment(dateStr).format('YYYY-MM-DD HH:mm');
	}
</script>

<svelte:head>
	<title>Scriptone - [プロセカ] アクティブユーザー数推移</title>
	<meta name="description" content="チアフルイベントの連勝のランキングを掲載しております。" />
	<meta name="twitter:site" content="@ToC1Kwin" />
	<meta name="twitter:creator" content="@ToC1Kwin" />
	<meta property="og:title" content="[プロセカ]アクティブユーザー数推移" />
	<meta name="twitter:title" content="[プロセカ]アクティブユーザー数推移" />
	<meta
		property="og:description"
		content="プロセカのアクティブユーザー数の推移をまとめております。"
	/>
	<meta
		name="twitter:description"
		content="プロセカのアクティブユーザー数の推移をまとめております。"
	/>
	<meta
		name="twitter:image"
		content="https://raw.githubusercontent.com/rmc8/ToC1Kwin/main/docs/assets/icon/eyecatch.jpg"
	/>
	<meta
		property="og:image"
		content="https://raw.githubusercontent.com/rmc8/ToC1Kwin/main/docs/assets/icon/eyecatch.jpg"
	/>
</svelte:head>

<Header />
<main>
	<article>
		<div class="container">
			{#if loading}
				<p>Loading...</p>
			{:else}
				<Chart />
				<div class="table-container">
					<table class="shj" style="font-size: 13.5px;">
						<thead>
							<tr>
								<th>{columns.event_id}</th>
								<th>{columns.event_name}</th>
								<th>{columns.event_type}</th>
								<th>{columns.start_datetime}</th>
								<th>{columns.end_datetime}</th>
								<th>{columns.duration}</th>
								<th>{columns.active_user_count}</th>
								<th>{columns.moving_average}</th>
							</tr>
						</thead>
						<tbody>
							{#each data as row}
								<tr>
									<td style="text-align: center">{row.event_id}</td>
									<td>{row.event_name}</td>
									<td>{row.event_type}</td>
									<td>{formatDate(row.start_datetime)}</td>
									<td>{formatDate(row.end_datetime)}</td>
									<td style="text-align: right">{row.duration}</td>
									<td style="text-align: right">{Number(row.active_user_count).toLocaleString()}</td
									>
									<td style="text-align: right">{Number(row.moving_average).toLocaleString()}</td>
								</tr>
							{/each}
						</tbody>
					</table>
				</div>
			{/if}
		</div>
	</article>
</main>

<Footer />
