<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/logo/scriptone_logo_icon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@rmc_km" />
		<meta name="twitter:creator" content="@rmc_km" />
		<meta property="og:title" content="Scriptone" />
		<meta property="og:site_name" content="Scriptone" />
		<meta property="og:image" content="https://rmc-8.com/logo/scriptone_card.png" />
		<link rel="preconnect" href="https://www.googletagmanager.com">
		<link rel="preconnect" href="https://pagead2.googlesyndication.com">
		%sveltekit.head%
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">%sveltekit.body%</div>
		<script type="module">
			const loadScripts = async () => {
				const loadScript = (src, attrs = {}) => {
					return new Promise((resolve, reject) => {
						const script = document.createElement('script');
						script.src = src;
						Object.entries(attrs).forEach(([key, value]) => script.setAttribute(key, value));
						script.onload = resolve;
						script.onerror = reject;
						document.head.appendChild(script);
					});
				};

				const loadAds = () => {
					return new Promise((resolve) => {
						(window.adsbygoogle = window.adsbygoogle || []).push({});
						loadScript("https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5016891070616278", {
							async: true,
							crossOrigin: "anonymous"
						}).then(resolve);
					});
				};

				try {
					// Google Tag Managerを最初に読み込む
					await loadScript("https://www.googletagmanager.com/gtag/js?id=G-TMCBTNX7PX", { async: true });

					// Google Analytics設定
					window.dataLayer = window.dataLayer || [];
					function gtag(){dataLayer.push(arguments);}
					gtag('js', new Date());
					gtag('config', 'G-TMCBTNX7PX', { 'send_page_view': false });

					// 重要なコンテンツを読み込んだ後に広告を読み込む
					await new Promise(resolve => {
						if (document.readyState === 'complete') {
							resolve();
						} else {
							window.addEventListener('load', resolve);
						}
					});

					// Intersection Observerを使用して広告の遅延読み込みを実装
					const observer = new IntersectionObserver((entries) => {
						entries.forEach(entry => {
							if (entry.isIntersecting) {
								loadAds();
								observer.disconnect();
							}
						});
					}, { threshold: 0.1 });

					// 広告を表示する要素を監視
					const adContainer = document.querySelector('.ad-container');
					if (adContainer) {
						observer.observe(adContainer);
					} else {
						// 広告コンテナがない場合は、一定時間後に読み込む
						setTimeout(loadAds, 3000);
					}

				} catch (error) {
					console.error('Script loading error:', error);
				}
			};

			// DOMContentLoadedイベントでスクリプトを読み込む
			document.addEventListener('DOMContentLoaded', loadScripts);
		</script>
	</body>
</html>